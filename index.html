<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Radio Log Mobile</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif; background: #f0f2f5; margin: 0; padding: 10px; color: #333; }
        h2 { text-align: center; margin: 5px 0 15px 0; color: #007bff; }
        .card { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 14px; }
        input, select, textarea { width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        .row { display: flex; gap: 10px; }
        .col { flex: 1; }
        
        button { width: 100%; padding: 12px; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; margin-bottom: 10px; transition: opacity 0.2s; }
        .btn-gps { background: #e3f2fd; color: #007bff; }
        .btn-save { background: #28a745; color: white; }
        .btn-export { background: #ff9800; color: white; }
        .btn-clear { background: #dc3545; color: white; margin-top: 5px;}
        button:active { opacity: 0.7; }

        #logList { list-style: none; padding: 0; }
        .log-item { background: white; padding: 10px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .log-info { font-size: 14px; }
        .log-time { font-size: 12px; color: #888; }
    </style>
</head>
<body>

    <h2>ğŸ“¡ Radio Logbook Mobile</h2>

    <div class="card">
        <div class="row">
            <div class="col">
                <label>æ—¥ä»˜</label>
                <input type="date" id="date">
            </div>
            <div class="col">
                <label>æ™‚åˆ»</label>
                <input type="time" id="time">
            </div>
        </div>

        <button type="button" class="btn-gps" onclick="getGPS()">ğŸ›°ï¸ ç¾åœ¨åœ°ã‚’å–å¾— (GPS)</button>
        <input type="text" id="my_location" placeholder="ç·¯åº¦, çµŒåº¦ (ã¾ãŸã¯ä½æ‰€)">

        <div class="row">
            <div class="col">
                <label>Callsign</label>
                <input type="text" id="callsign" placeholder="JO1ZYX" style="text-transform: uppercase;">
            </div>
            <div class="col">
                <label>Band</label>
                <select id="band">
                    <option>å¸‚æ°‘ãƒ©ã‚¸ã‚ª/CB</option>
                    <option>ãƒ‡ã‚¸ã‚¿ãƒ«ç°¡æ˜“ç„¡ç·š/DCR</option>
                    <option>ç‰¹å®šå°é›»åŠ›ç„¡ç·š/SLPR</option>
                    <option>ãƒ‡ã‚¸ã‚¿ãƒ«å°é›»åŠ›ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£/LCR</option>
                    <option>ã‚¢ãƒãƒãƒ¥ã‚¢ç„¡ç·š/Ham</option>
                </select>
            </div>
        </div>

        <div class="row">
            <div class="col"><label>Ch</label><input type="text" id="channel"></div>
            <div class="col"><label>RS</label><input type="text" id="rs" placeholder="59/59"></div>
        </div>

        <label>ç›¸æ‰‹åœ° / å‚™è€ƒ</label>
        <input type="text" id="location" placeholder="ç›¸æ‰‹ã®é‹ç”¨åœ°ãªã©">
        
        <label>ã‚³ãƒ¡ãƒ³ãƒˆ</label>
        <textarea id="content" rows="2" placeholder="äº¤ä¿¡å†…å®¹ãƒ¡ãƒ¢"></textarea>

        <button type="button" class="btn-save" onclick="addLog()">ğŸ’¾ ãƒ­ã‚°ä¿å­˜ (Listè¿½åŠ )</button>
    </div>

    <div class="card">
        <h3 style="margin-top:0;">ä¿å­˜æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿: <span id="count">0</span>ä»¶</h3>
        <button type="button" class="btn-export" onclick="exportJSON()">ğŸ“¤ PCç”¨ãƒ•ã‚¡ã‚¤ãƒ«æ›¸å‡º (JSON)</button>
        <ul id="logList"></ul>
        <button type="button" class="btn-clear" onclick="clearLogs()">ğŸ—‘ï¸ å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤</button>
    </div>

    <script>
        // åˆæœŸåŒ–
        document.getElementById('date').valueAsDate = new Date();
        document.getElementById('time').value = new Date().toTimeString().slice(0,5);
        
        // ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
        let logs = JSON.parse(localStorage.getItem('radio_logs')) || [];
        renderLogs();

        // GPSå–å¾—
        function getGPS() {
            if (!navigator.geolocation) { alert("GPSéå¯¾å¿œã§ã™"); return; }
            document.querySelector('.btn-gps').innerText = "æ¸¬ä½ä¸­...";
            navigator.geolocation.getCurrentPosition(pos => {
                const lat = pos.coords.latitude.toFixed(5);
                const lon = pos.coords.longitude.toFixed(5);
                document.getElementById('my_location').value = `${lat}, ${lon}`;
                document.querySelector('.btn-gps').innerText = "ğŸ›°ï¸ ç¾åœ¨åœ°ã‚’å–å¾— (GPS)";
            }, err => {
                alert("GPSã‚¨ãƒ©ãƒ¼: " + err.message);
                document.querySelector('.btn-gps').innerText = "ğŸ›°ï¸ ç¾åœ¨åœ°ã‚’å–å¾— (GPS)";
            }, { enableHighAccuracy: true });
        }

        // ãƒ­ã‚°è¿½åŠ 
        function addLog() {
            const entry = {
                start_time: `${document.getElementById('date').value} ${document.getElementById('time').value}`,
                callsign: document.getElementById('callsign').value.toUpperCase(),
                band: document.getElementById('band').value,
                channel: document.getElementById('channel').value,
                rs: document.getElementById('rs').value,
                my_location: document.getElementById('my_location').value,
                location: document.getElementById('location').value,
                content: document.getElementById('content').value
            };

            if(!entry.callsign) { alert("ã‚³ãƒ¼ãƒ«ã‚µã‚¤ãƒ³ã¯å¿…é ˆã§ã™"); return; }

            logs.unshift(entry); // å…ˆé ­ã«è¿½åŠ 
            saveAndRender();
            
            // å…¥åŠ›æ¬„ã‚¯ãƒªã‚¢ï¼ˆæ—¥ä»˜ãƒ»å ´æ‰€ã¯æ®‹ã™ï¼‰
            document.getElementById('callsign').value = "";
            document.getElementById('channel').value = "";
            document.getElementById('rs').value = "";
            document.getElementById('location').value = "";
            document.getElementById('content').value = "";
            document.getElementById('time').value = new Date().toTimeString().slice(0,5);
            alert("ä¿å­˜ã—ã¾ã—ãŸ");
        }

        // JSONæ›¸ãå‡ºã—ï¼ˆã“ã“ãŒPCé€£æºã®ã‚­ãƒ¢ï¼ï¼‰
        function exportJSON() {
            if(logs.length === 0) { alert("ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"); return; }
            
            const jsonStr = JSON.stringify(logs, null, 2);
            const blob = new Blob([jsonStr], {type: "application/json"});
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            const filename = `mobile_log_${new Date().toISOString().slice(0,10)}.json`;
            a.download = filename;
            
            // iOSå¯¾å¿œ
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        // æç”»ãƒ»ä¿å­˜ãƒ»å‰Šé™¤
        function saveAndRender() {
            localStorage.setItem('radio_logs', JSON.stringify(logs));
            renderLogs();
        }

        function renderLogs() {
            const list = document.getElementById('logList');
            list.innerHTML = "";
            document.getElementById('count').innerText = logs.length;
            
            logs.forEach((log, index) => {
                const li = document.createElement('li');
                li.className = "log-item";
                li.innerHTML = `
                    <div>
                        <div class="log-info"><b>${log.callsign}</b> (${log.band})</div>
                        <div class="log-time">${log.start_time}</div>
                    </div>
                    <button onclick="deleteLog(${index})" style="width:auto; padding:5px 10px; margin:0; background:#eee; color:#333;">Ã—</button>
                `;
                list.appendChild(li);
            });
        }

        function deleteLog(index) {
            if(confirm("å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) {
                logs.splice(index, 1);
                saveAndRender();
            }
        }

        function clearLogs() {
            if(confirm("æœ¬å½“ã«å…¨ã¦ã®ãƒ­ã‚°ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) {
                logs = [];
                saveAndRender();
            }
        }
    </script>
</body>
</html>
